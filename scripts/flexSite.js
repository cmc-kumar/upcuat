/*
Copyright(c) 2012 Company Name
*/
Ext.define("Ext.ux.touch.grid.feature.Abstract",{config:{events:{},extraCls:null,grid:null},constructor:function(a){this.initConfig(a);this.callParent([a])},updateEvents:function(f){var g=this,e=g.getGrid(),c,h;for(c in f){if(f.hasOwnProperty(c)){h=f[c];if(c==="grid"){c=e}else{if(c==="header"){c=e.getHeader()}else{if(c==="headerEl"){c=e.getHeader().element}else{if(c==="gridBody"){c=e.element.down("div.x-body")}else{if(c==="store"){c=e.getStore()}else{c=e[c]}}}}}var d,b,a;if(Ext.isObject(c)){for(d in h){b=h[d];if(Ext.isObject(b)){a=Ext.apply({},b);delete a.fn;b=b.fn}c.on(d,g[b],g,a||{})}}else{console.warn("Class could not be found in config.events Object")}}}}});Ext.define("Ext.ux.touch.grid.feature.Paging",{extend:"Ext.ux.touch.grid.feature.Abstract",requires:["Ext.ux.touch.grid.feature.Abstract","Ext.Toolbar","Ext.Button","Ext.Panel"],config:{events:{store:{load:"handleGridPaint"}},extraCls:"paging",goToButton:{disabled:true,text:"Go to page..."},backButton:{disabled:true,text:"Previous Page",ui:"back"},forwardButton:{disabled:true,text:"Next Page",ui:"forward"},pager:{docked:"bottom"},pageListTpl:"Page {page}",goToPicker:{centered:true,modal:true,width:200,height:200,layout:"fit",hideOnMaskTap:true},pages:0},backText:"back",init:function(b){var a=b.getStore();if(!a.isLoading()){b.on("painted","handleGridPaint",this,{buffer:50})}},applyGoToPicker:function(b,a){if(!b.hasOwnProperty("items")){b.items=[{xtype:"list",itemTpl:this.getPageListTpl(),store:new Ext.data.Store({fields:["page"]}),listeners:{scope:this,itemtap:"handlePageSelect"}}]}return Ext.factory(b,Ext.Panel,a)},applyPager:function(a,b){return Ext.factory(a,Ext.Toolbar,b)},updatePager:function(a,d){var c=this,b=c.getGrid();if(d){b.remove(d)}if(a){b.insert(0,a)}},applyBackButton:function(b,a){Ext.apply(b,{action:"back",disabled:true,scope:this,handler:"handleBackButton"});return Ext.factory(b,Ext.Button,a)},applyGoToButton:function(b,a){Ext.apply(b,{action:"goTo",disabled:true,scope:this,handler:"handleGoToButton"});return Ext.factory(b,Ext.Button,a)},applyForwardButton:function(b,a){Ext.apply(b,{action:"forward",disabled:true,scope:this,handler:"handleForwardButton"});return Ext.factory(b,Ext.Button,a)},updateBackButton:function(d,c){var e=this,b=e.getPager(),a=0;if(c){a=b.getInnerItems().indexOf(c);b.remove(c)}if(d){b.insert(a,d);e.checkSpacers()}},updateGoToButton:function(d,c){var e=this,b=e.getPager(),a=2;if(c){a=b.getInnerItems().indexOf(c);b.remove(c)}if(d){b.insert(a,d);e.checkSpacers()}},updateForwardButton:function(d,c){var e=this,b=e.getPager(),a=4;if(c){a=b.getInnerItems().indexOf(c);b.remove(c)}if(d){b.insert(a,d);e.checkSpacers()}},checkSpacers:function(){var f=this,b=this.getPager(),d=b.getInnerItems(),g=f.getForwardButton(),c=f.getGoToButton(),a,e;if(g){a=d.indexOf(g);if(a>0){e=d[a-1];if(!e.isXType("spacer")){b.insert(a,{xtype:"spacer"})}}}if(c){a=d.indexOf(c);if(a>0){e=d[a-1];if(!e.isXType("spacer")){b.insert(a,{xtype:"spacer"})}}}},handleGridPaint:function(a){if(!(a instanceof Ext.ux.touch.grid.List)){a=this.getGrid()}var e=this,h=a.getStore();if(h.isLoading()){h.on("load","handleGridPaint",e,{single:true});return}h.on("clear","handleGridPaint",e,{single:true});var f=h.getTotalCount(),d=h.currentPage,c=Math.ceil(f/h.getPageSize()),i=e.getBackButton(),g=e.getForwardButton(),b=e.getGoToButton();e.setPages(c);i.setDisabled(d===1||h.getCount()===0);g.setDisabled(d===c||h.getCount()===0);b.setDisabled(c===0||h.getCount()===0)},handleBackButton:function(){var b=this.getGrid(),a=b.getStore();a.previousPage()},handleForwardButton:function(){var b=this.getGrid(),a=b.getStore();a.nextPage()},handleGoToButton:function(e){var f=this,c=f.getGoToPicker(),a=f.getPages(),d=1,g=[];var b=c.down("list").getStore();b.removeAll();for(;d<=a;d++){g.push({page:d})}b.add(g);c.showBy(e)},handlePageSelect:function(e,c){var a=e.up("panel"),b=this.getGrid().getStore(),d=c+1;b.loadPage(d);a.hide()}});Ext.define("Ext.ux.touch.grid.feature.Sorter",{extend:"Ext.ux.touch.grid.feature.Abstract",requires:"Ext.ux.touch.grid.feature.Abstract",config:{events:{grid:{sort:"updateHeaderIcons"},headerEl:{tap:"handleHeaderTap"}},extraCls:"sorter",asc:"x-grid-sort-asc",desc:"x-grid-sort-desc"},init:function(c){var b=c.getStore(),a=b.isSorted?b.isSorted():b.getData().sorted;if(a){if(c.rendered){c.fireEvent("sort")}else{c.on("painted",function(){c.fireEvent("sort")},null,{single:true})}}},onDestroy:function(){var c=this,a=c.grid,d=a.header,b=d.el;b.un({scope:c,tap:c.handleHeaderTap});a.un({scope:c,sort:c.updateHeaderIcons})},isSortable:function(a,b){return !(a.stopSort||b.sortable==false)},handleHeaderTap:function(h,o){h.isStopped=true;var l=this,a=l.getGrid(),g=a.getColumns(),j=0,k=g.length,n=a.getStore(),b=Ext.get(o),m=b.getAttribute("dataindex"),i=n.getSorters(),p=i[0],d=(p&&(p.getProperty()===m))?p.getDirection():"DESC",f;for(;j<k;j++){f=g[j];if(f.dataIndex===m){break}}if(a.fireEvent("beforesort",a,f)===false||!l.isSortable(a,f)){return}n.sort(m,d==="DESC"?"ASC":"DESC");if(n.getRemoteSort()===true){n.load()}else{a.refresh()}a.fireEvent("sort")},updateHeaderIcons:function(){var i=this,a=i.getGrid(),l=a.getStore(),h=l.getSorters(),e=a.getHeader(),m=e.element,o=0,f=h.length,k=this.getAsc(),g=this.getDesc(),d,j,b,n,c;i.clearSort();for(;o<f;o++){n=h[o];j=n.getProperty();c=n.getDirection();d=a.getColumn(j);b=d.element;if(!b){b=d.element=Ext.get(m.down("div.x-grid-cell-hd[dataindex="+j+"]"))}b&&b.addCls(c==="DESC"?g:k)}},clearSort:function(){var a=this.getGrid(),e=a.getColumns(),f=a.getHeader(),l=f.element,h=0,i=e.length,k=this.getAsc(),g=this.getDesc(),d,j,b;for(;h<i;h++){d=e[h];j=d.dataIndex;b=d.element;if(!b){b=d.element=Ext.get(l.down("div.x-grid-cell-hd[dataindex="+j+"]"))}if(b){b.removeCls(k).removeCls(g)}}}});Ext.define("Ext.field.TextAreaInput",{extend:"Ext.field.Input",xtype:"textareainput",tag:"textarea"});Ext.define("Ext.field.TextArea",{extend:"Ext.field.Text",xtype:"textareafield",requires:["Ext.field.TextAreaInput"],alternateClassName:"Ext.form.TextArea",config:{ui:"textarea",autoCapitalize:false,component:{xtype:"textareainput"},maxRows:null},updateMaxRows:function(a){this.getComponent().setMaxRows(a)},doSetHeight:function(a){this.callParent(arguments);var b=this.getComponent();b.input.setHeight(a)},doSetWidth:function(b){this.callParent(arguments);var a=this.getComponent();a.input.setWidth(b)},doKeyUp:function(a){var b=a.getValue();a[b?"showClearIcon":"hideClearIcon"]()}});Ext.define("Ext.MessageBox",{extend:"Ext.Sheet",requires:["Ext.Toolbar","Ext.field.Text","Ext.field.TextArea"],config:{ui:"dark",baseCls:Ext.baseCSSPrefix+"msgbox",iconCls:null,showAnimation:{type:"popIn",duration:250,easing:"ease-out"},hideAnimation:{type:"popOut",duration:250,easing:"ease-out"},zIndex:10,defaultTextHeight:75,title:null,buttons:null,message:null,prompt:null,layout:{type:"vbox",pack:"center"}},statics:{OK:{text:"OK",itemId:"ok",ui:"action"},YES:{text:"Yes",itemId:"yes",ui:"action"},NO:{text:"No",itemId:"no"},CANCEL:{text:"Cancel",itemId:"cancel"},INFO:Ext.baseCSSPrefix+"msgbox-info",WARNING:Ext.baseCSSPrefix+"msgbox-warning",QUESTION:Ext.baseCSSPrefix+"msgbox-question",ERROR:Ext.baseCSSPrefix+"msgbox-error",OKCANCEL:[{text:"Cancel",itemId:"cancel"},{text:"OK",itemId:"ok",ui:"action"}],YESNOCANCEL:[{text:"Cancel",itemId:"cancel"},{text:"No",itemId:"no"},{text:"Yes",itemId:"yes",ui:"action"}],YESNO:[{text:"No",itemId:"no"},{text:"Yes",itemId:"yes",ui:"action"}]},constructor:function(a){a=a||{};if(a.hasOwnProperty("promptConfig")){Ext.Logger.deprecate("'promptConfig' config is deprecated, please use 'prompt' config instead",this);Ext.applyIf(a,{prompt:a.promptConfig});delete a.promptConfig}if(a.hasOwnProperty("multiline")||a.hasOwnProperty("multiLine")){a.prompt=a.prompt||{};Ext.applyIf(a.prompt,{multiLine:a.multiline||a.multiLine});delete a.multiline;delete a.multiLine}this.defaultAllowedConfig={};var e=["ui","showAnimation","hideAnimation","title","message","prompt","iconCls","buttons","defaultTextHeight"],d=e.length,b,c;for(b=0;b<d;b++){c=e[b];this.defaultAllowedConfig[c]=this.defaultConfig[c]}this.callParent([a])},applyTitle:function(a){if(typeof a=="string"){a={title:a}}Ext.applyIf(a,{docked:"top",cls:this.getBaseCls()+"-title"});return Ext.factory(a,Ext.Toolbar,this.getTitle())},updateTitle:function(a){if(a){this.add(a)}},updateButtons:function(a){var b=this;if(a){if(b.buttonsToolbar){b.buttonsToolbar.removeAll();b.buttonsToolbar.setItems(a)}else{b.buttonsToolbar=Ext.create("Ext.Toolbar",{docked:"bottom",defaultType:"button",layout:{type:"hbox",pack:"center"},ui:b.getUi(),cls:b.getBaseCls()+"-buttons",items:a});b.add(b.buttonsToolbar)}}},applyMessage:function(a){a={html:a,cls:this.getBaseCls()+"-text"};return Ext.factory(a,Ext.Component,this._message)},updateMessage:function(a){if(a){this.add(a)}},getMessage:function(){if(this._message){return this._message.getHtml()}return null},applyIconCls:function(a){a={xtype:"component",docked:"left",width:40,height:40,baseCls:Ext.baseCSSPrefix+"icon",hidden:(a)?false:true,cls:a};return Ext.factory(a,Ext.Component,this._iconCls)},updateIconCls:function(a,b){var c=this;this.getTitle();this.getButtons();if(a&&!b){this.add(a)}else{this.remove(b)}},getIconCls:function(){var b=this._iconCls,a;if(b){a=b.getCls();return(a)?a[0]:null}return null},applyPrompt:function(a){if(a){var b={label:false};if(Ext.isObject(a)){Ext.apply(b,a)}if(b.multiLine){b.height=Ext.isNumber(b.multiLine)?parseFloat(b.multiLine):this.getDefaultTextHeight();return Ext.factory(b,Ext.field.TextArea,this.getPrompt())}else{return Ext.factory(b,Ext.field.Text,this.getPrompt())}}return a},updatePrompt:function(a,b){if(a){this.add(a)}if(b){this.remove(b)}},onClick:function(c){if(c){var b=c.config.userConfig||{},d=c.getInitialConfig(),a=this.getPrompt();if(typeof b.fn=="function"){this.on({hiddenchange:function(){b.fn.call(b.scope||null,d.itemId||d.text,a?a.getValue():null,b)},single:true,scope:this})}if(b.input){b.input.dom.blur()}}this.hide()},show:function(f){if(!this.getParent()&&Ext.Viewport){Ext.Viewport.add(this)}if(!f){return this.callParent()}var b=Ext.Object.merge({},{value:""},f);var e=f.buttons||Ext.MessageBox.OK||[],d=[],c=f;Ext.each(e,function(g){if(!g){return}d.push(Ext.apply({userConfig:c,scope:this,handler:"onClick"},g))},this);b.buttons=d;if(b.promptConfig){Ext.Logger.deprecate("'promptConfig' config is deprecated, please use 'prompt' config instead",this)}b.prompt=(b.promptConfig||b.prompt)||null;if(b.multiLine){b.prompt=b.prompt||{};b.prompt.multiLine=b.multiLine;delete b.multiLine}b=Ext.merge({},this.defaultAllowedConfig,b);this.setConfig(b);var a=this.getPrompt();if(a){a.setValue(f.value||"")}this.callParent();return this},alert:function(d,c,b,a){return this.show({title:d,message:c,buttons:Ext.MessageBox.OK,promptConfig:false,fn:function(){if(b){b.apply(a,arguments)}},scope:a})},confirm:function(d,c,b,a){return this.show({title:d,message:c,buttons:Ext.MessageBox.YESNO,promptConfig:false,scope:a,fn:function(){if(b){b.apply(a,arguments)}}})},prompt:function(g,d,c,b,f,e,a){return this.show({title:g,message:d,buttons:Ext.MessageBox.OKCANCEL,scope:b,prompt:a||true,multiLine:f,value:e,fn:function(){if(c){c.apply(b,arguments)}}})}},function(a){this.override({setIcon:function(b,c){Ext.Logger.deprecate("Ext.MessageBox#setIcon is deprecated, use setIconCls instead",2);this.setIconCls(b);return this},updateText:function(b){Ext.Logger.deprecate("Ext.MessageBox#updateText is deprecated, use setMessage instead",2);this.setMessage(b);return this}});Ext.onSetup(function(){Ext.Msg=new a})});Ext.define("FlexMobile.view.FlexMobile",{extend:"Ext.tab.Panel",requires:["Ext.MessageBox","Ext.TitleBar","FlexMobile.view.Summary","FlexMobile.view.Payment","FlexMobile.view.History"],config:{items:[{xtype:"summary",title:flexMobileAppRes.summary,iconCls:"home"},{xtype:"payment",scrollable:"vertical",title:flexMobileAppRes.payment,iconCls:"action"},{xtype:"history",title:flexMobileAppRes.history,iconCls:"info"}],tabBar:{docked:"bottom"}}});Ext.define("FlexMobile.store.FundingAccounts",{extend:"Ext.data.Store",requires:["FlexMobile.model.FundingAccount"],config:{autoLoad:true,model:"FlexMobile.model.FundingAccount",storeId:"FundingAccountStore",proxy:{type:"ajax",url:flexMobileAppRes.urlFundingAccount,reader:{type:"json"}}}});Ext.define("FlexMobile.store.HistoryPayments",{extend:"Ext.data.Store",requires:["FlexMobile.model.Payment"],config:{autoLoad:true,model:"FlexMobile.model.Payment",storeId:"HistoryPaymentStore",sorters:[{property:"paymentDate",direction:"DESC"}],proxy:{type:"ajax",url:flexMobileAppRes.urlHistoryPayment,reader:{type:"json",totalProperty:"total",rootProperty:"root"}}}});Ext.application({requires:["Ext.MessageBox"],models:["FundingAccount","Payment"],stores:["FundingAccounts","HistoryPayments"],views:["FlexMobile","Summary","Payment","History"],name:"FlexMobile",launch:function(){Ext.create("FlexMobile.view.FlexMobile",{fullscreen:true})}});
